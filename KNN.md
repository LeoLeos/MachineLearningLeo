---


---

<h2 id="跟着leo机器学习实战——k-近邻算法">跟着Leo机器学习实战——K-近邻算法</h2>
<h3 id="概述（核心思想）">概述（核心思想）</h3>
<blockquote>
<p>选出以待分类的一个样本与<strong>他最近的K个已知标签</strong>的样本中,这K个样本中的属于<strong>相同label的个数最多</strong>,则将这个待分类样本<strong>分给这一类.</strong></p>
</blockquote>
<h3 id="举例">举例</h3>
<blockquote>
<p>如果<strong>K=3</strong>，绿色圆点的最近的3个邻居是2个红色小三角形和1个蓝色小正方形，少数从属于多数，基于统计的方法，判定绿色的这个待分类点<strong>属于红色的三角形一类。</strong><br>
如果<strong>K=5</strong>，绿色圆点的最近的5个邻居是2个红色三角形和3个蓝色的正方形，还是少数从属于多数，基于统计的方法，判定绿色的这个待分类点<strong>属于蓝色的正方形一类</strong>。<br>
<img src="https://s2.ax1x.com/2020/02/15/1vqB5j.png" alt="1vqB5j.png"></p>
</blockquote>
<h3 id="优点">优点</h3>
<blockquote>
<p>精确度高，对异常值不敏感，无数据输入假定</p>
</blockquote>
<h3 id="缺点">缺点</h3>
<blockquote>
<p>计算复杂度和空间复杂度高</p>
</blockquote>
<h3 id="实战--使用knn改进约会网站的配对效果">实战–使用KNN改进约会网站的配对效果</h3>
<h4 id="准备数据">准备数据</h4>
<pre class=" language-py"><code class="prism  language-py">    <span class="token keyword">def</span> <span class="token function">file2matrix</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">:</span>  
        fr <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>  
        numberOfLines <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>fr<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>         <span class="token comment">#获取文件行数  </span>
      returnMat <span class="token operator">=</span> zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>numberOfLines<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment">#构建零矩阵  </span>
      classLabelVector <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>                       <span class="token comment">#构建准备存储label向量  </span>
      fr <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>  
        index <span class="token operator">=</span> <span class="token number">0</span>  
      <span class="token comment">#将文件转化为矩阵  </span>
      <span class="token keyword">for</span> line <span class="token keyword">in</span> fr<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  
            <span class="token comment">#去掉每行首尾空格回车符  </span>
		    line <span class="token operator">=</span> line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>  
            listFromLine <span class="token operator">=</span> line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\t'</span><span class="token punctuation">)</span>  
            returnMat<span class="token punctuation">[</span>index<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> listFromLine<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span>  
      
            classLabelVector<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>listFromLine<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
            index <span class="token operator">+=</span> <span class="token number">1</span>  
      <span class="token keyword">return</span> returnMat<span class="token punctuation">,</span>classLabelVector

    datingDataMat<span class="token punctuation">,</span>datingLabels<span class="token operator">=</span>kNN<span class="token punctuation">.</span>file2matrix<span class="token punctuation">(</span><span class="token string">'datingTestSet2.txt'</span><span class="token punctuation">)</span>  
    <span class="token comment">#print(returnMat,classLabelVector)  </span>
    <span class="token comment">#实例化画图视图  </span>
    fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token punctuation">)</span>  
    <span class="token comment">#选择子图  </span>
    ax <span class="token operator">=</span> fig<span class="token punctuation">.</span>add_subplot<span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">)</span>  
    ax<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>datingDataMat<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>datingDataMat<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">15.0</span><span class="token operator">*</span>array<span class="token punctuation">(</span>datingLabels<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">15.0</span><span class="token operator">*</span>array<span class="token punctuation">(</span>datingLabels<span class="token punctuation">)</span><span class="token punctuation">)</span>  
    ax<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>datingDataMat<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>datingDataMat<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">15.0</span><span class="token operator">*</span>array<span class="token punctuation">(</span>datingLabels<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">15.0</span><span class="token operator">*</span>array<span class="token punctuation">(</span>datingLabels<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">#显示画图结果  </span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p><img src="https://s2.ax1x.com/2020/02/14/1jD30e.jpg" alt="1jD30e.jpg"><br>
<img src="https://s2.ax1x.com/2020/02/14/1jD4nU.jpg" alt="1jD4nU.jpg"></p>
<h3 id="算法核心（分类器）">算法核心（分类器）</h3>
<pre class=" language-python"><code class="prism  language-python">    <span class="token keyword">def</span> <span class="token function">classify0</span><span class="token punctuation">(</span>inX<span class="token punctuation">,</span> dataSet<span class="token punctuation">,</span> labels<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">:</span>  
        dataSetSize <span class="token operator">=</span> dataSet<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  
        diffMat <span class="token operator">=</span> tile<span class="token punctuation">(</span>inX<span class="token punctuation">,</span> <span class="token punctuation">(</span>dataSetSize<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> dataSet      <span class="token comment">#tile产生以inX为元素包，形成(dataSetSize,1)矩阵，返回inX与dataSet各点坐标差值。  </span>
	    sqDiffMat <span class="token operator">=</span> diffMat<span class="token operator">**</span><span class="token number">2</span> <span class="token comment">#计算点inX与各点欧式距离平方。  </span>
        sqDistances <span class="token operator">=</span> sqDiffMat<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>     <span class="token comment">#以行为点，对列求和  </span>
        distances <span class="token operator">=</span> sqDistances<span class="token operator">**</span><span class="token number">0.5</span> <span class="token comment">#开方  </span>
        sortedDistIndicies <span class="token operator">=</span> distances<span class="token punctuation">.</span>argsort<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment">#从小到大排序的下标  </span>
        classCount<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">:</span>  
	        voteIlabel <span class="token operator">=</span> labels<span class="token punctuation">[</span>sortedDistIndicies<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span>      <span class="token comment">#获取按sortedDistIndicies排序的label  </span>
	        classCount<span class="token punctuation">[</span>voteIlabel<span class="token punctuation">]</span> <span class="token operator">=</span> classCount<span class="token punctuation">.</span>get<span class="token punctuation">(</span>voteIlabel<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token comment">#获取与距离最小的前k个分给voteIlabel类有几次  </span>
        sortedClassCount <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>classCount<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span>operator<span class="token punctuation">.</span>itemgetter<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>     <span class="token comment">#按分给某一类的次数排序  </span>
        <span class="token keyword">return</span> sortedClassCount<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>       <span class="token comment">#返回分给次数最多的label</span>
        
</code></pre>
<h3 id="归一化公式">归一化公式</h3>
<p><strong>new = (oldValue-minValue)/(maxValue-minValue)</strong></p>
<pre class=" language-py"><code class="prism  language-py"><span class="token keyword">def</span> <span class="token function">autoNorm</span><span class="token punctuation">(</span>dataSet<span class="token punctuation">)</span><span class="token punctuation">:</span>  
    minVals <span class="token operator">=</span> dataSet<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  
    maxVals <span class="token operator">=</span> dataSet<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  
    ranges <span class="token operator">=</span> maxVals <span class="token operator">-</span> minVals  
    <span class="token comment">#产生与输入矩阵一样大小的零矩阵  </span>
	normDataSet <span class="token operator">=</span> zeros<span class="token punctuation">(</span>shape<span class="token punctuation">(</span>dataSet<span class="token punctuation">)</span><span class="token punctuation">)</span>  
    <span class="token comment">#获取行数  </span>
  m <span class="token operator">=</span> dataSet<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  
    <span class="token comment">#对输入矩阵减去最小值  </span>
  normDataSet <span class="token operator">=</span> dataSet <span class="token operator">-</span> tile<span class="token punctuation">(</span>minVals<span class="token punctuation">,</span> <span class="token punctuation">(</span>m<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
    <span class="token comment">#除以maxVals 与 minVals的差值  </span>
  normDataSet <span class="token operator">=</span> normDataSet<span class="token operator">/</span>tile<span class="token punctuation">(</span>ranges<span class="token punctuation">,</span> <span class="token punctuation">(</span>m<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">#element wise divide  </span>
  <span class="token comment">#返回归一化之后的矩阵，最大值与最小值的差以及最小值</span>
  <span class="token keyword">return</span> normDataSet<span class="token punctuation">,</span> ranges<span class="token punctuation">,</span> minVals
</code></pre>
<h3 id="测试算法">测试算法</h3>
<pre class=" language-py"><code class="prism  language-py"><span class="token keyword">def</span> <span class="token function">datingClassTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  
    <span class="token comment">#设置测试样本与样本数比例  </span>
  hoRatio <span class="token operator">=</span> <span class="token number">0.50</span> <span class="token comment">#hold out 10%  </span>
 <span class="token comment">#加载数据  datingDataMat,datingLabels = file2matrix('datingTestSet2.txt')       #load data setfrom file  </span>
 <span class="token comment">#归一化  normMat, ranges, minVals = autoNorm(datingDataMat)  </span>
    m <span class="token operator">=</span> normMat<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  
    <span class="token comment">#设置k值  </span>
  numTestVecs <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>m<span class="token operator">*</span>hoRatio<span class="token punctuation">)</span>  
    <span class="token comment">#初始化错误率  </span>
  errorCount <span class="token operator">=</span> <span class="token number">0.0</span>  
  <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>numTestVecs<span class="token punctuation">)</span><span class="token punctuation">:</span>  
        <span class="token comment">#判别normMat[i,:]测试样本的类别  </span>
        classifierResult <span class="token operator">=</span> classify0<span class="token punctuation">(</span>normMat<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span>normMat<span class="token punctuation">[</span>numTestVecs<span class="token punctuation">:</span>m<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span>datingLabels<span class="token punctuation">[</span>numTestVecs<span class="token punctuation">:</span>m<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>  
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"the classifier came back with: %d, the real answer is: %d"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>classifierResult<span class="token punctuation">,</span> datingLabels<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
        <span class="token keyword">if</span> <span class="token punctuation">(</span>classifierResult <span class="token operator">!=</span> datingLabels<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> errorCount <span class="token operator">+=</span> <span class="token number">1.0</span>  
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"the total error rate is: %f"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>errorCount<span class="token operator">/</span><span class="token builtin">float</span><span class="token punctuation">(</span>numTestVecs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
    <span class="token keyword">print</span><span class="token punctuation">(</span>errorCount<span class="token punctuation">)</span>
</code></pre>
<h3 id="预测">预测</h3>
<pre class=" language-py"><code class="prism  language-py"><span class="token keyword">def</span> <span class="token function">classifyPerson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  
   resultList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'not at all'</span><span class="token punctuation">,</span> <span class="token string">'in small does'</span><span class="token punctuation">,</span> <span class="token string">'in large does'</span><span class="token punctuation">]</span>  
   percentTats <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'percentTage of time spent playing video game?'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
   ffMiles <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'frequent filer miles earned per years?'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
   iceCream <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'liters of ice cream consumed per year?'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
   datingDataMat<span class="token punctuation">,</span> datingLabels <span class="token operator">=</span> file2matrix<span class="token punctuation">(</span><span class="token string">'datingTestSet2.txt'</span><span class="token punctuation">)</span>  
   normMat<span class="token punctuation">,</span>ranges<span class="token punctuation">,</span> minVals <span class="token operator">=</span> autoNorm<span class="token punctuation">(</span>datingDataMat<span class="token punctuation">)</span>  
   <span class="token comment">#将三者转化成数组，之前打错成大括号，变成列表，报错！  </span>
 inArr <span class="token operator">=</span> array<span class="token punctuation">(</span><span class="token punctuation">[</span>ffMiles<span class="token punctuation">,</span> percentTats<span class="token punctuation">,</span> iceCream<span class="token punctuation">]</span><span class="token punctuation">)</span>  
   <span class="token comment">#调用kNN函数进行预测  </span>
 classifierResult <span class="token operator">=</span> classify0<span class="token punctuation">(</span><span class="token punctuation">(</span>inArr <span class="token operator">-</span> minVals<span class="token punctuation">)</span><span class="token operator">/</span>ranges<span class="token punctuation">,</span>normMat<span class="token punctuation">,</span> datingLabels<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>  
   <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'You will probably like this person:'</span><span class="token punctuation">,</span>resultList<span class="token punctuation">[</span>classifierResult <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="手写数字系统识别">手写数字系统识别</h2>
<h3 id="流程">流程</h3>
<div class="mermaid"><svg xmlns="http://www.w3.org/2000/svg" id="mermaid-svg-P8IemLGGOaWjyHKB" width="100%" style="max-width: 874.140625px;" viewBox="0 0 874.140625 62"><g transform="translate(-12, -12)"><g class="output"><g class="clusters"></g><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M104,43L129,43L154,43" marker-end="url(#arrowhead1025)" style="fill:none"></path><defs><marker id="arrowhead1025" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M238,43L263,43L288,43" marker-end="url(#arrowhead1026)" style="fill:none"></path><defs><marker id="arrowhead1026" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M372,43L397,43L422,43" marker-end="url(#arrowhead1027)" style="fill:none"></path><defs><marker id="arrowhead1027" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M610.140625,43L635.140625,43L660.140625,43" marker-end="url(#arrowhead1028)" style="fill:none"></path><defs><marker id="arrowhead1028" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M744.140625,43L769.140625,43L794.140625,43" marker-end="url(#arrowhead1029)" style="fill:none"></path><defs><marker id="arrowhead1029" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" style="opacity: 1;" transform=""><g transform="translate(0,0)" class="label"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel" style="opacity: 1;" transform=""><g transform="translate(0,0)" class="label"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel" style="opacity: 1;" transform=""><g transform="translate(0,0)" class="label"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel" style="opacity: 1;" transform=""><g transform="translate(0,0)" class="label"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel" style="opacity: 1;" transform=""><g transform="translate(0,0)" class="label"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g class="node" style="opacity: 1;" id="收集数据" transform="translate(62,43)"><rect rx="0" ry="0" x="-42" y="-23" width="84" height="46"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-32,-13)"><foreignObject width="64" height="26"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">收集数据</div></foreignObject></g></g></g><g class="node" style="opacity: 1;" id="准备数据" transform="translate(196,43)"><rect rx="0" ry="0" x="-42" y="-23" width="84" height="46"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-32,-13)"><foreignObject width="64" height="26"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">准备数据</div></foreignObject></g></g></g><g class="node" style="opacity: 1;" id="分析数据" transform="translate(330,43)"><rect rx="0" ry="0" x="-42" y="-23" width="84" height="46"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-32,-13)"><foreignObject width="64" height="26"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">分析数据</div></foreignObject></g></g></g><g class="node" style="opacity: 1;" id="训练算法" transform="translate(516.0703125,43)"><rect rx="5" ry="5" x="-94.0703125" y="-23" width="188.140625" height="46"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-84.0703125,-13)"><foreignObject width="168.140625" height="26"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">此步骤不适合k近邻算法</div></foreignObject></g></g></g><g class="node" style="opacity: 1;" id="测试算法" transform="translate(702.140625,43)"><rect rx="0" ry="0" x="-42" y="-23" width="84" height="46"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-32,-13)"><foreignObject width="64" height="26"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">测试算法</div></foreignObject></g></g></g><g class="node" style="opacity: 1;" id="使用算法" transform="translate(836.140625,43)"><rect rx="0" ry="0" x="-42" y="-23" width="84" height="46"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-32,-13)"><foreignObject width="64" height="26"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">使用算法</div></foreignObject></g></g></g></g></g></g></svg></div>
<h3 id="测试算法：使用k-近邻算法识别手写数字">测试算法：使用k-近邻算法识别手写数字</h3>
<pre class=" language-py"><code class="prism  language-py"><span class="token keyword">def</span> <span class="token function">handwritingClassTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  
    hwLabels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>         
    trainingFileList <span class="token operator">=</span> listdir<span class="token punctuation">(</span><span class="token string">'trainingDigits'</span><span class="token punctuation">)</span>           <span class="token comment">#load the training set加载训练集  </span>
  m <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>trainingFileList<span class="token punctuation">)</span>       <span class="token comment">#训练集样本数  </span>
  trainingMat <span class="token operator">=</span> zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">)</span>       <span class="token comment">#为美国样本初始化一个零向量，以存储每个样本的向量  </span>
  <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">:</span>  
        fileNameStr <span class="token operator">=</span> trainingFileList<span class="token punctuation">[</span>i<span class="token punctuation">]</span>  
        fileStr <span class="token operator">=</span> fileNameStr<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>     <span class="token comment">#take off .txt  </span>
  classNumStr <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>fileStr<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'_'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  
        hwLabels<span class="token punctuation">.</span>append<span class="token punctuation">(</span>classNumStr<span class="token punctuation">)</span>  
        trainingMat<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> img2vector<span class="token punctuation">(</span><span class="token string">'trainingDigits/%s'</span> <span class="token operator">%</span> fileNameStr<span class="token punctuation">)</span>  
    testFileList <span class="token operator">=</span> listdir<span class="token punctuation">(</span><span class="token string">'testDigits'</span><span class="token punctuation">)</span>        <span class="token comment">#iterate through the test set加载测试集  </span>
  errorCount <span class="token operator">=</span> <span class="token number">0.0</span>  
  mTest <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>testFileList<span class="token punctuation">)</span>  
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>mTest<span class="token punctuation">)</span><span class="token punctuation">:</span>  
        fileNameStr <span class="token operator">=</span> testFileList<span class="token punctuation">[</span>i<span class="token punctuation">]</span>  
        fileStr <span class="token operator">=</span> fileNameStr<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>     <span class="token comment">#take off .txt  </span>
  classNumStr <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>fileStr<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'_'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  
        vectorUnderTest <span class="token operator">=</span> img2vector<span class="token punctuation">(</span><span class="token string">'testDigits/%s'</span> <span class="token operator">%</span> fileNameStr<span class="token punctuation">)</span>     <span class="token comment">#将测试集的每个样本逐步向量化  </span>
  classifierResult <span class="token operator">=</span> classify0<span class="token punctuation">(</span>vectorUnderTest<span class="token punctuation">,</span> trainingMat<span class="token punctuation">,</span> hwLabels<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>     <span class="token comment">#为其分类  </span>
  <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"the classifier came back with: %d, the real answer is: %d"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>classifierResult<span class="token punctuation">,</span> classNumStr<span class="token punctuation">)</span><span class="token punctuation">)</span>  
        <span class="token keyword">if</span> <span class="token punctuation">(</span>classifierResult <span class="token operator">!=</span> classNumStr<span class="token punctuation">)</span><span class="token punctuation">:</span> errorCount <span class="token operator">+=</span> <span class="token number">1.0</span> <span class="token comment">#计算分错类的个数  </span>
  <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"\nthe total number of errors is: %d"</span> <span class="token operator">%</span> errorCount<span class="token punctuation">)</span>  
    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"\nthe total error rate is: %f"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>errorCount<span class="token operator">/</span><span class="token builtin">float</span><span class="token punctuation">(</span>mTest<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>     <span class="token comment">#错误率</span>
</code></pre>

